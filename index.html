<!DOCTYPE html>
<html>
	<head>
		<style>
			table, th, td {
				border: 1px solid black;
			}
			pre {
				width: 40%;
			}	
			@media only screen and (max-width: 714px) {
				pre {
					width: 97%;
				}
			}
			</style>
	<script type="module">
		import * as pdfjsLib from './pdf.mjs';

		pdfjsLib.GlobalWorkerOptions.workerSrc =
			'./pdf.worker.mjs';
		

		function render_page(pageData) {

			let render_options = {
				normalizeWhitespace: false,
				disableCombineTextItems: false
			}

			return pageData.getTextContent(render_options)
				.then(function(textContent) {
					console.log(textContent)
					let lastY, text = '';for (let item of textContent.items) {
						if (lastY == item.transform[5] || !lastY){
							text += item.str;
						}  
						else{
							text += '\n' + item.str;
						}    
						lastY = item.transform[5];
					}
					return text;
				});
		}

		function extractText(pdf_File, id) {
			var pdfx = pdfjsLib.getDocument(pdf_File);
			pdfx.promise.then(function(data){
				console.log(data.numPages)
				var countPromises = [];
				for(let i =1;i<=data.numPages;i++){
					countPromises.push(
						data.getPage(i).then(e => {
							// console.log(e)
							return render_page(e)})
					)
					
				}
				// console.log(countPromises)
				Promise.all(countPromises).then(e =>
				{
					// console.log(e)
					let yuk = e.join("\n\n");
					// console.log(yuk)
					// this.id;
					// console.log(id)
					const drop_zone = document.getElementById(id);
					drop_zone.textContent = yuk;
				})
			})
		}


		function ok(ev){

			console.log("ada disini")
			ev.preventDefault();
			
		}

		function darimana(e){
			console.log("dari sini")
			e.preventDefault();
			if(e.dataTransfer && e.dataTransfer.files.length == 1){
				var files = e.dataTransfer.files[0];
				// console.log(files)
				let koka = new FileReader();
				koka.onload = (e) => {
					extractText( e.target.result, this.id)
				}
				koka.readAsArrayBuffer(files)
			}else{
				console.log("gagal drag and drop")
			}
		}

		const drop_zone = document.getElementById("drop_zone");
		drop_zone.addEventListener("dragover", ok);
		drop_zone.addEventListener("drop", darimana);
		const drop_zone2 = document.getElementById("drop_zone2");
		drop_zone2.addEventListener("dragover", ok);
		drop_zone2.addEventListener("drop", darimana);

	</script>
	<script src="./cocok.js"></script>
	<script>
		function bandingkan(){

			let drop_zone = document.getElementById("drop_zone");
			let drop_zone2 = document.getElementById("drop_zone2");
			let text1 = drop_zone.textContent;
			let text2 = drop_zone2.textContent;
			// if(drop_zonex.textContent == )
			if(text1 == 'Drag PDF ke kotak ini ( drop zone ).' || text1 == 'gagal drag and drop') return
			if(text2 == 'Drag PDF ke kotak ini ( drop zone ).' || text2 == 'gagal drag and drop') return
			mainsk(text1, text2, 0.7).then(e => {
				tabel(e);
			})
		}

		function tabel(koyo){
			const tablekonten = document.getElementById('tablekonten');
			const trxs = document.createElement('tr');
            let paragraf2 = ["No 1","Dokumen 1", "Dokumen 2", "No 2"];
            for (let j=0;j<4;j++){
                const thsc = document.createElement('th');
                thsc.textContent = paragraf2[j]
                trxs.append(thsc)
            }
            tablekonten.append(trxs)
            for (let i =0;i<koyo["paragraf"].length;i++){
                // console.log(koyo["paragraf"][i])
                const trxsx = document.createElement('tr');
                let opp1 = document.createElement('td')
                let opp2 = document.createElement('td')
                let opp3 = document.createElement('td')
                let opp4 = document.createElement('td')
                opp1.textContent =koyo["paragraf"][i][0]
                opp2.textContent =koyo["iyuk"][koyo["paragraf"][i][0]-1]
                opp3.textContent =koyo["iyuks"][koyo["paragraf"][i][1]-1]
                opp4.textContent =koyo["paragraf"][i][1]
                trxsx.append(opp1);
                trxsx.append(opp2);
                trxsx.append(opp3);
                trxsx.append(opp4);
                // // for (let j=0;j<2;j++){
                //     const thsc = document.createElement('td');
                //     thsc.textContent = koyo["iyuk"][koyo["paragraf"][i][j]];
                    // trxsx.append(thsc)
                // }
                // iyuk
                // trxs.textContent = koyo["paragraf"][i][0]
                tablekonten.append(trxsx)
                tablekonten.hidden=false;
			}
		}
	</script>
	</head>

	<body style="width: auto;height: auto;">

		<pre
		id="drop_zone"
		style="border: 5px solid blue;overflow: auto;height:15em; display: inline-block;">Drag PDF ke kotak ini ( drop zone ).</pre>
		<div style="display: inline-block;width: 16%;"></div>

		<pre
		id="drop_zone2"
		style="border: 5px solid blue;overflow: auto;height: 15em; display: inline-block;">Drag PDF ke kotak ini ( drop zone ).</pre>

		<br><button onclick="bandingkan()">harus</button>
		<table id="tablekonten" style="width:100%" hidden="true"></table>


		
	</body>
</html>